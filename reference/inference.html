<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>statistical inference on greta models — inference • greta</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>


<!-- docsearch -->
<script src="../docsearch.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous" />
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>



<meta property="og:title" content="statistical inference on greta models — inference" />
<meta property="og:description" content="Carry out statistical inference on greta models by
MCMC or likelihood/posterior optimisation." />
<meta property="og:image" content="https://greta-stats.org/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <style type="text/css">
.logo {
    display: inline-block;
    width: 144px;
    height: 40px;
    background-image: url(../reference/figures/name_icon_on_purple.png);
    background-size: 100% auto;
    background-repeat: no-repeat;
    vertical-align: middle;
}
</style>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    <a class="logo" href="../index.html"></a>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/get_started.html">get started</a>
</li>
<li>
  <a href="../reference/index.html">docs</a>
</li>
<li>
  <a href="../articles/example_models.html">examples</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    analyses
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/analyses/eight_schools.html">eight schools</a>
    </li>
    <li>
      <a href="../articles/analyses/election_88.html">election 88</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    more
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/webpages/why_greta.html">why 'greta'?</a>
    </li>
    <li>
      <a href="../articles/webpages/technical_details.html">technical details</a>
    </li>
    <li>
      <a href="../articles/webpages/software.html">software</a>
    </li>
    <li>
      <a href="../articles/webpages/contribute.html">contribute to greta</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://forum.greta-stats.org">
    <span class="fas fa-lg fa-comments"></span>
     
  </a>
</li>
<li>
  <a href="http://twitter.com/greta_stats">
    <span class="fas fa-lg fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/greta-dev/greta">
    <span class="fas fa-lg fa-github"></span>
     
  </a>
</li>
      </ul>
      
      <form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
        </div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<hr style="height:5px; visibility:hidden;" />

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>statistical inference on greta models</h1>
    <small class="dont-index">Source: <a href='https://github.com/greta-dev/greta/blob/master/R/inference.R'><code>R/inference.R</code></a></small>
    <div class="hidden name"><code>inference.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Carry out statistical inference on greta models by
MCMC or likelihood/posterior optimisation.</p>
    </div>

    <pre class="usage"><span class='fu'>mcmc</span><span class='op'>(</span>
  <span class='va'>model</span>,
  sampler <span class='op'>=</span> <span class='fu'><a href='samplers.html'>hmc</a></span><span class='op'>(</span><span class='op'>)</span>,
  n_samples <span class='op'>=</span> <span class='fl'>1000</span>,
  thin <span class='op'>=</span> <span class='fl'>1</span>,
  warmup <span class='op'>=</span> <span class='fl'>1000</span>,
  chains <span class='op'>=</span> <span class='fl'>4</span>,
  n_cores <span class='op'>=</span> <span class='cn'>NULL</span>,
  verbose <span class='op'>=</span> <span class='cn'>TRUE</span>,
  pb_update <span class='op'>=</span> <span class='fl'>50</span>,
  one_by_one <span class='op'>=</span> <span class='cn'>FALSE</span>,
  initial_values <span class='op'>=</span> <span class='fu'>initials</span><span class='op'>(</span><span class='op'>)</span>,
  trace_batch_size <span class='op'>=</span> <span class='fl'>100</span>
<span class='op'>)</span>

<span class='fu'>stashed_samples</span><span class='op'>(</span><span class='op'>)</span>

<span class='fu'>extra_samples</span><span class='op'>(</span>
  <span class='va'>draws</span>,
  n_samples <span class='op'>=</span> <span class='fl'>1000</span>,
  thin <span class='op'>=</span> <span class='fl'>1</span>,
  n_cores <span class='op'>=</span> <span class='cn'>NULL</span>,
  verbose <span class='op'>=</span> <span class='cn'>TRUE</span>,
  pb_update <span class='op'>=</span> <span class='fl'>50</span>,
  one_by_one <span class='op'>=</span> <span class='cn'>FALSE</span>,
  trace_batch_size <span class='op'>=</span> <span class='fl'>100</span>
<span class='op'>)</span>

<span class='fu'>initials</span><span class='op'>(</span><span class='va'>...</span><span class='op'>)</span>

<span class='fu'>opt</span><span class='op'>(</span>
  <span class='va'>model</span>,
  optimiser <span class='op'>=</span> <span class='fu'><a href='optimisers.html'>bfgs</a></span><span class='op'>(</span><span class='op'>)</span>,
  max_iterations <span class='op'>=</span> <span class='fl'>100</span>,
  tolerance <span class='op'>=</span> <span class='fl'>1e-06</span>,
  initial_values <span class='op'>=</span> <span class='fu'>initials</span><span class='op'>(</span><span class='op'>)</span>,
  adjust <span class='op'>=</span> <span class='cn'>TRUE</span>,
  hessian <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>model</th>
      <td><p>greta_model object</p></td>
    </tr>
    <tr>
      <th>sampler</th>
      <td><p>sampler used to draw values in MCMC. See
<code><a href='samplers.html'>samplers()</a></code> for options.</p></td>
    </tr>
    <tr>
      <th>n_samples</th>
      <td><p>number of MCMC samples to draw per chain (after any warm-up,
but before thinning)</p></td>
    </tr>
    <tr>
      <th>thin</th>
      <td><p>MCMC thinning rate; every <code>thin</code> samples is retained, the
rest are discarded</p></td>
    </tr>
    <tr>
      <th>warmup</th>
      <td><p>number of samples to spend warming up the mcmc sampler (moving
chains toward the highest density area and tuning sampler hyperparameters).</p></td>
    </tr>
    <tr>
      <th>chains</th>
      <td><p>number of MCMC chains to run</p></td>
    </tr>
    <tr>
      <th>n_cores</th>
      <td><p>the maximum number of CPU cores used by each sampler (see
details).</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>whether to print progress information to the console</p></td>
    </tr>
    <tr>
      <th>pb_update</th>
      <td><p>how regularly to update the progress bar (in iterations).
If <code>pb_update</code> is less than or equal to <code>thin</code>, it will be set
to <code>thin + 1</code> to ensure at least one saved iteration per
<code>pb_update</code> iterations.</p></td>
    </tr>
    <tr>
      <th>one_by_one</th>
      <td><p>whether to run TensorFlow MCMC code one iteration at a
time, so that greta can handle numerical errors as 'bad' proposals (see
below).</p></td>
    </tr>
    <tr>
      <th>initial_values</th>
      <td><p>an optional <code>initials</code> object (or list of
<code>initials</code> objects of length <code>chains</code>) giving initial values for
some or all of the variables in the model. These will be used as the
starting point for sampling/optimisation.</p></td>
    </tr>
    <tr>
      <th>trace_batch_size</th>
      <td><p>the number of posterior samples to process at a time
when tracing the parameters of interest; reduce this to reduce memory
demands</p></td>
    </tr>
    <tr>
      <th>draws</th>
      <td><p>a greta_mcmc_list object returned by <code>mcmc</code> or
<code>stashed_samples</code></p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>named numeric values, giving initial values of some or all of the
variables in the model (unnamed variables will be automatically
initialised)</p></td>
    </tr>
    <tr>
      <th>optimiser</th>
      <td><p>an <code>optimiser</code> object giving the optimisation algorithm
and parameters See <code><a href='optimisers.html'>optimisers()</a></code>.</p></td>
    </tr>
    <tr>
      <th>max_iterations</th>
      <td><p>the maximum number of iterations before giving up</p></td>
    </tr>
    <tr>
      <th>tolerance</th>
      <td><p>the numerical tolerance for the solution, the optimiser
stops when the (absolute) difference in the joint density between
successive iterations drops below this level</p></td>
    </tr>
    <tr>
      <th>adjust</th>
      <td><p>whether to account for Jacobian adjustments in the joint
density. Set to <code>FALSE</code> (and do not use priors) for maximum likelihood
estimates, or <code>TRUE</code> for maximum <em>a posteriori</em> estimates.</p></td>
    </tr>
    <tr>
      <th>hessian</th>
      <td><p>whether to return a list of <em>analytically</em> differentiated
Hessian arrays for the parameters</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>mcmc</code>, <code>stashed_samples</code> &amp; <code>extra_samples</code> - a
<code>greta_mcmc_list</code> object that can be analysed using functions from the
coda package. This will contain mcmc samples of the greta arrays used to
create <code>model</code>.</p>
<p><code>opt</code> - a list containing the following named elements:</p><ul>
<li><p><code>par</code> a named list of the optimal values for the greta arrays
specified in <code>model</code></p></li>
<li><p><code>value</code> the (unadjusted) negative log joint density of the
model at the parameters 'par'</p></li>
<li><p><code>iterations</code> the number of iterations taken by the optimiser</p></li>
<li><p><code>convergence</code> an integer code, 0 indicates successful
completion, 1 indicates the iteration limit <code>max_iterations</code> had
been reached</p></li>
<li><p><code>hessian</code> (if <code>hessian = TRUE</code>) a named list of hessian
matrices/arrays for the parameters (w.r.t. <code>value</code>)</p></li>
</ul>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>For <code>mcmc()</code> if <code>verbose = TRUE</code>, the progress bar shows
the number of iterations so far and the expected time to complete the phase
of model fitting (warmup or sampling). Occasionally, a proposed set of
parameters can cause numerical instability (I.e. the log density or its
gradient is <code>NA</code>, <code>Inf</code> or <code>-Inf</code>); normally because the log
joint density is so low that it can't be represented as a floating point
number. When this happens, the progress bar will also display the
proportion of proposals so far that were 'bad' (numerically unstable) and
therefore rejected. Some numerical instability during the warmup phase is
normal, but 'bad' samples during the sampling phase can lead to bias in
your posterior sample. If you only have a few bad samples (&lt;10\%), you can
usually resolve this with a longer warmup period or by manually defining
starting values to move the sampler into a more reasonable part of the
parameter space. If you have more samples than that, it may be that your
model is misspecified. You can often diagnose this by using
<code><a href='calculate.html'>calculate()</a></code> to evaluate the values of greta arrays, given
fixed values of model parameters, and checking the results are what you
expect.</p>
<p>greta runs multiple chains simultaneously with a single sampler,
vectorising all operations across the chains. E.g. a scalar addition in
your model is computed as an elementwise vector addition (with vectors
having length <code>chains</code>), a vector addition is computed as a matrix
addition etc. TensorFlow is able to parallelise these operations, and this
approach reduced computational overheads, so this is the most efficient of
computing on multiple chains.</p>
<p>Multiple mcmc samplers (each of which can simultaneously run multiple
chains) can also be run in parallel by setting the execution plan with the
<code>future</code> package. Only <code>plan(multisession)</code> futures or
<code>plan(cluster)</code> futures that don't use fork clusters are allowed,
since forked processes conflict with TensorFlow's parallelism. Explicitly
parallelising chains on a local machine with <code>plan(multisession)</code> will
probably be slower than running multiple chains simultaneously in a single
sampler (with <code>plan(sequential)</code>, the default) because of the overhead
required to start new sessions. However, <code>plan(cluster)</code> can be used
to run chains on a cluster of machines on a local or remote network. See
<code><a href='https://rdrr.io/pkg/future/man/cluster.html'>future::cluster()</a></code> for details, and the
<code>future.batchtools</code> package to set up plans on clusters with job
schedulers.</p>
<p>If <code>n_cores = NULL</code> and mcmc samplers are being run sequentially, each
sampler will be allowed to use all CPU cores (possibly to compute multiple
chains sequentially). If samplers are being run in parallel with the
<code>future</code> package, <code>n_cores</code> will be set so that <code>n_cores * [future::nbrOfWorkers]</code> is less than the number
of CPU cores.</p>
<p>After carrying out mcmc on all the model parameters, <code>mcmc()</code>
calculates the values of (i.e. traces) the parameters of interest for each
of these samples, similarly to <code><a href='calculate.html'>calculate()</a></code>. Multiple
posterior samples can be traced simultaneously, though this can require
large amounts of memory for large models. As in <code>calculate</code>, the
argument <code>trace_batch_size</code> can be modified to trade-off speed against
memory usage.</p>
<p>If the sampler is aborted before finishing (and <code>future</code>
parallelism isn't being used), the samples collected so far can be
retrieved with <code>stashed_samples()</code>. Only samples from the sampling
phase will be returned.</p>
<p>Samples returned by <code>mcmc()</code> and <code>stashed_samples()</code> can
be added to with <code>extra_samples()</code>. This continues the chain from the
last value of the previous chain and uses the same sampler and model as was
used to generate the previous samples. It is not possible to change the
sampler or extend the warmup period.</p>
<p>Because <code>opt()</code> acts on a list of greta arrays with possibly
varying dimension, the <code>par</code> and <code>hessian</code> objects returned by
<code>opt()</code> are named lists, rather than a vector (<code>par</code>) and a
matrix (<code>hessian</code>), as returned by <code><a href='https://rdrr.io/r/stats/optim.html'>stats::optim()</a></code>.
Because greta arrays may not be vectors, the Hessians may not be matrices,
but could be higher-dimensional arrays. To return a Hessian matrix covering
multiple model parameters, you can construct your model so that all those
parameters are in a vector, then split the vector up to define the model.
The parameter vector can then be passed to model. See example.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='co'># define a simple Bayesian model</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span>
<span class='va'>mu</span> <span class='op'>&lt;-</span> <span class='fu'><a href='distributions.html'>normal</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>5</span><span class='op'>)</span>
<span class='va'>sigma</span> <span class='op'>&lt;-</span> <span class='fu'><a href='distributions.html'>lognormal</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>0.1</span><span class='op'>)</span>
<span class='fu'><a href='distribution.html'>distribution</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='distributions.html'>normal</a></span><span class='op'>(</span><span class='va'>mu</span>, <span class='va'>sigma</span><span class='op'>)</span>
<span class='va'>m</span> <span class='op'>&lt;-</span> <span class='fu'><a href='model.html'>model</a></span><span class='op'>(</span><span class='va'>mu</span>, <span class='va'>sigma</span><span class='op'>)</span>

<span class='co'># carry out mcmc on the model</span>
<span class='va'>draws</span> <span class='op'>&lt;-</span> <span class='fu'>mcmc</span><span class='op'>(</span><span class='va'>m</span>, n_samples <span class='op'>=</span> <span class='fl'>100</span><span class='op'>)</span>

<span class='co'># add some more samples</span>
<span class='va'>draws</span> <span class='op'>&lt;-</span> <span class='fu'>extra_samples</span><span class='op'>(</span><span class='va'>draws</span>, <span class='fl'>200</span><span class='op'>)</span>

<span class='co'>#' # initial values can be passed for some or all model variables</span>
<span class='va'>draws</span> <span class='op'>&lt;-</span> <span class='fu'>mcmc</span><span class='op'>(</span><span class='va'>m</span>, chains <span class='op'>=</span> <span class='fl'>1</span>, initial_values <span class='op'>=</span> <span class='fu'>initials</span><span class='op'>(</span>mu <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># if there are multiple chains, a list of initial values should be passed,</span>
<span class='co'># othewise the same initial values will be used for all chains</span>
<span class='va'>inits</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='fu'>initials</span><span class='op'>(</span>sigma <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span>, <span class='fu'>initials</span><span class='op'>(</span>sigma <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>draws</span> <span class='op'>&lt;-</span> <span class='fu'>mcmc</span><span class='op'>(</span><span class='va'>m</span>, chains <span class='op'>=</span> <span class='fl'>2</span>, initial_values <span class='op'>=</span> <span class='va'>inits</span><span class='op'>)</span>

<span class='co'># you can auto-generate a list of initials with something like this:</span>
<span class='va'>inits</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>replicate</a></span><span class='op'>(</span><span class='fl'>4</span>,
  <span class='fu'>initials</span><span class='op'>(</span>mu <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span>, sigma <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>,
  simplify <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span>
<span class='va'>draws</span> <span class='op'>&lt;-</span> <span class='fu'>mcmc</span><span class='op'>(</span><span class='va'>m</span>, chains <span class='op'>=</span> <span class='fl'>4</span>, initial_values <span class='op'>=</span> <span class='va'>inits</span><span class='op'>)</span>

<span class='co'># or find the MAP estimate</span>
<span class='va'>opt_res</span> <span class='op'>&lt;-</span> <span class='fu'>opt</span><span class='op'>(</span><span class='va'>m</span><span class='op'>)</span>

<span class='co'># get the MLE of the normal variance</span>
<span class='va'>mu</span> <span class='op'>&lt;-</span> <span class='fu'><a href='variable.html'>variable</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>variance</span> <span class='op'>&lt;-</span> <span class='fu'><a href='variable.html'>variable</a></span><span class='op'>(</span>lower <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span>
<span class='fu'><a href='distribution.html'>distribution</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='distributions.html'>normal</a></span><span class='op'>(</span><span class='va'>mu</span>, <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='va'>variance</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>m2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='model.html'>model</a></span><span class='op'>(</span><span class='va'>variance</span><span class='op'>)</span>

<span class='co'># adjust = FALSE skips the jacobian adjustments used in MAP estimation, to</span>
<span class='co'># give the true maximum likelihood estimates</span>
<span class='va'>o</span> <span class='op'>&lt;-</span> <span class='fu'>opt</span><span class='op'>(</span><span class='va'>m2</span>, adjust <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>

<span class='co'># the MLE corresponds to the *unadjusted* sample variance, but differs</span>
<span class='co'># from the sample variance</span>
<span class='va'>o</span><span class='op'>$</span><span class='va'>par</span>
<span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>x</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span> <span class='co'># same</span>
<span class='fu'><a href='https://rdrr.io/r/stats/cor.html'>var</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='co'># different</span>

<span class='co'># initial values can also be passed to optimisers:</span>
<span class='va'>o</span> <span class='op'>&lt;-</span> <span class='fu'>opt</span><span class='op'>(</span><span class='va'>m2</span>, initial_values <span class='op'>=</span> <span class='fu'>initials</span><span class='op'>(</span>variance <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># and you can return a list of the Hessians for each of these parameters</span>
<span class='va'>o</span> <span class='op'>&lt;-</span> <span class='fu'>opt</span><span class='op'>(</span><span class='va'>m2</span>, hessians <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='va'>o</span><span class='op'>$</span><span class='va'>hessians</span>


<span class='co'># to get a hessian matrix across multiple greta arrays, you must first</span>
<span class='co'># combine them and then split them up for use in the model (so that the</span>
<span class='co'># combined vector is part of the model) and pass that vector to model:</span>
<span class='va'>params</span> <span class='op'>&lt;-</span> <span class='fu'><a href='extract-replace-combine.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='variable.html'>variable</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='fu'><a href='variable.html'>variable</a></span><span class='op'>(</span>lower <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>mu</span> <span class='op'>&lt;-</span> <span class='va'>params</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>
<span class='va'>variance</span> <span class='op'>&lt;-</span> <span class='va'>params</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>
<span class='fu'><a href='distribution.html'>distribution</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='distributions.html'>normal</a></span><span class='op'>(</span><span class='va'>mu</span>, <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='va'>variance</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>m3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='model.html'>model</a></span><span class='op'>(</span><span class='va'>params</span><span class='op'>)</span>
<span class='va'>o</span> <span class='op'>&lt;-</span> <span class='fu'>opt</span><span class='op'>(</span><span class='va'>m3</span>, hessians <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='va'>o</span><span class='op'>$</span><span class='va'>hessians</span>
<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>


      <footer>
      

      </footer>
   </div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script>
<script>
  docsearch({
    
    
    apiKey: 'fa1406e0044eae29be11408a723039e7',
    indexName: 'greta',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>



  </body>
</html>


