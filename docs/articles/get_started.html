<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Get started with greta • greta</title>
<link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Get started with greta">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><style type="text/css">
.logo {
    display: inline-block;
    width: 144px;
    height: 40px;
    background-image: url(../../logos/name_icon_on_purple.png);
    background-size: 100% auto;
    background-repeat: no-repeat;
    vertical-align: middle;
}
</style>
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    <a class="logo" href="../index.html"></a>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/get_started.html">get started</a>
</li>
<li>
  <a href="../reference/index.html">docs</a>
</li>
<li>
  <a href="../articles/example_models.html">models</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    analyses
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/analyses/eight_schools.html">eight schools</a>
    </li>
    <li>
      <a href="../articles/analyses/election_88.html">election 88</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    more
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/webpages/why_greta.html">why 'greta'?</a>
    </li>
    <li>
      <a href="../articles/webpages/technical_details.html">technical details</a>
    </li>
    <li>
      <a href="../articles/webpages/software.html">software</a>
    </li>
    <li>
      <a href="../articles/webpages/contribute.html">contribute to greta</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://forum.greta-stats.org">
    <span class="fa fa-lg fa-comments"></span>
     
  </a>
</li>
<li>
  <a href="http://twitter.com/greta_stats">
    <span class="fa fa-lg fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/greta-dev/greta">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><hr style="height:5px; visibility:hidden;">
<hr>
<script src="get_started_files/htmlwidgets-1.2/htmlwidgets.js"></script><script src="get_started_files/viz-0.3/viz.js"></script><link href="get_started_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="get_started_files/grViz-binding-1.0.0/grViz.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Get started with greta</h1>
            
      
    </div>

    
    
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install the stable version of greta from CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">"greta"</span>)</a></code></pre></div>
<p>or the development version from GitHub using devtools:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">devtools<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/devtools/topics/install_github">install_github</a></span>(<span class="st">"greta-dev/greta"</span>)</a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">library</span>(greta)</a></code></pre></div>
<hr>
<div id="tensorflow" class="section level3">
<h3 class="hasAnchor">
<a href="#tensorflow" class="anchor"></a>TensorFlow</h3>
<p>Before you can fit models with greta, you will also need to have a working installation of Google’s <a href="https://www.tensorflow.org/">TensorFlow</a> python package (version 1.8.0 or higher) and the <a href="https://github.com/tensorflow/probability">tensorflow-probability</a> python package. greta exports <code><a href="http://www.rdocumentation.org/packages/tensorflow/topics/install_tensorflow">install_tensorflow()</a></code> from the <code>tensorflow</code> R package, which you can use to install the latest versions of these packages from within your R session:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">tensorflow<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/tensorflow/topics/install_tensorflow">install_tensorflow</a></span>(<span class="dt">extra_packages=</span><span class="st">"tensorflow-probability"</span>)</a></code></pre></div>
<p>You can use this function to install different versions of TensorFlow, including versions with GPU acceleration. If you’re having trouble with this step, <a href="https://tensorflow.rstudio.com/installation.html">this guide</a> may help.</p>
<p>Unfortunately, TensorFlow Probability isn’t available from the Anaconda version control system, so if you are using Anaconda, you will need to install TensorFlow Probability separately.</p>
<hr>
</div>
<div id="diagrammer" class="section level3">
<h3 class="hasAnchor">
<a href="#diagrammer" class="anchor"></a>DiagrammeR</h3>
<p>greta’s <a href="#plotting">plotting functionality</a> depends on the <a href="http://rich-iannone.github.io/DiagrammeR/">DiagrammeR package</a>. Because DiagrammeR depends on the <a href="http://igraph.org/r/">igraph</a> package, which contains a large amount of code tthat needs to be compiled, DiagrammeR often takes a long time to install. So, DiagrammeR isn’t installed automatically with greta. If you want to plot greta models, you can install igraph and DiagrammeR from CRAN.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">"igraph"</span>)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="kw">install.packages</span>(<span class="st">"DiagrammeR"</span>)</a></code></pre></div>
<p>igraph can be difficult to install on some machines, due to dependencies on the <a href="https://cran.r-project.org/web/packages/XML/index.html">XML</a> R package and libxml2 and gfortran software libraries. There are workarounds to these issues (e.g. <a href="http://r.789695.n4.nabble.com/Problem-installing-libxml2-under-Homebrew-td4748381.html">here</a> and <a href="https://askubuntu.com/questions/859256/how-to-install-gcc-7-or-clang-4-">here</a>) but if you can’t get it to work, you can still use greta for everything except plotting models.</p>
<hr>
</div>
</div>
<div id="how-greta-works" class="section level2">
<h2 class="hasAnchor">
<a href="#how-greta-works" class="anchor"></a>How greta works</h2>
<p>greta lets us build statistical models interactively in R, and then sample from them by MCMC. We build greta models with <em>greta array</em> objects, which behave much like R’s array, matrix and vector objects for numeric data. Like those numeric data objects, greta arrays can be manipulated with functions and mathematical operators to create new greta arrays.</p>
<p>The key difference between greta arrays and numeric data objects is that when you do something to a greta array, greta <em>doesn’t calculate the values</em> of the new greta array. Instead, it just remembers what operation to do, and works out the size and shape of the result.</p>
<p>For example, we can create a greta array <code>z</code> representing some data (a 3x3 matrix of 1s):</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">(z &lt;-<span class="st"> </span><span class="kw"><a href="../reference/structures.html">ones</a></span>(<span class="dv">3</span>, <span class="dv">3</span>))</a></code></pre></div>
<pre><code>greta array (data)

     [,1] [,2] [,3]
[1,]    1    1    1
[2,]    1    1    1
[3,]    1    1    1</code></pre>
<p>we can then create a new greta array <code>z2</code> by doing something to <code>z</code>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">(z2 &lt;-<span class="st"> </span>z <span class="op">+</span><span class="st"> </span>z <span class="op">^</span><span class="st"> </span><span class="dv">2</span>)</a></code></pre></div>
<pre><code>greta array (operation)

     [,1] [,2] [,3]
[1,]  ?    ?    ?  
[2,]  ?    ?    ?  
[3,]  ?    ?    ?  </code></pre>
<p>greta knows the result must also be a 3x3 matrix, but it doesn’t try to calculate the results. Instead it treats the new greta array <code>z2</code> like a placeholder, for which it will calculate the results later.</p>
<p>Because greta only creates <em>placeholders</em> when we’re building our model, we can construct models using greta arrays that represent unknown variables. For example, if we create a new greta array <code>a</code> representing some unknown values, we can still manipulate it as though it were data:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">(a &lt;-<span class="st"> </span><span class="kw"><a href="../reference/variable.html">variable</a></span>(<span class="dt">dim =</span> <span class="kw"><a href="../reference/extract-replace-combine.html">c</a></span>(<span class="dv">3</span>, <span class="dv">3</span>)))</a></code></pre></div>
<pre><code>greta array (variable)

     [,1] [,2] [,3]
[1,]  ?    ?    ?  
[2,]  ?    ?    ?  
[3,]  ?    ?    ?  </code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">(a2 &lt;-<span class="st"> </span>a <span class="op">+</span><span class="st"> </span>a <span class="op">^</span><span class="st"> </span><span class="dv">2</span>)</a></code></pre></div>
<pre><code>greta array (operation)

     [,1] [,2] [,3]
[1,]  ?    ?    ?  
[2,]  ?    ?    ?  
[3,]  ?    ?    ?  </code></pre>
<p>This allows us to create a wide range of models, like in the general-purpose modelling languages like BUGS and Stan. But unlike those languages we build greta models interactively in R so get feedback immediately if there’s a mistake like a misspelled variable name or if one of our greta arrays has the wrong shape.</p>
<p>greta also lets us declare that a greta array follows a probability distribution, allowing us to train models using observed data, and to define prior distributions over our parameters, for Bayesian analyses.</p>
<p>The rest of this vignette walks through an example of fitting a model using greta. If you’d like to see examples of some common models fitted in greta and with equivalent BUGS and Stan code, take a look at <a href="example_models.html">Example models</a>. If you’d like more technical details about how greta works under the hood, check out <a href="technical_details.html">Technical details</a>.</p>
<hr>
</div>
<div id="building-a-model" class="section level2">
<h2 class="hasAnchor">
<a href="#building-a-model" class="anchor"></a>Building a model</h2>
<p>The rest of the vignette explains step-by-step how to build, visualise and fit a model with greta. We’ll be stepping through a model for linear regression between two of the variables in the <a href="https://en.wikipedia.org/wiki/Iris_flower_data_set"><code>iris</code></a> dataset, which is included with base R. The model is <em>Bayesian</em> (we specify priors over the variables), though it is also possible to do frequentist (no priors) inference in greta, using <code><a href="../reference/variable.html">variable()</a></code> instead of a probability distribution to create random variables.</p>
<p>Here’s the whole script to specify and fit the model:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">library</span>(greta)</a>
<a class="sourceLine" id="cb14-2" data-line-number="2"></a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="co"># data</span></a>
<a class="sourceLine" id="cb14-4" data-line-number="4">x &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as_data.html">as_data</a></span>(iris<span class="op">$</span>Petal.Length)</a>
<a class="sourceLine" id="cb14-5" data-line-number="5">y &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as_data.html">as_data</a></span>(iris<span class="op">$</span>Sepal.Length)</a>
<a class="sourceLine" id="cb14-6" data-line-number="6"></a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="co"># variables and priors</span></a>
<a class="sourceLine" id="cb14-8" data-line-number="8">int &lt;-<span class="st"> </span><span class="kw"><a href="../reference/distributions.html">normal</a></span>(<span class="dv">0</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb14-9" data-line-number="9">coef &lt;-<span class="st"> </span><span class="kw"><a href="../reference/distributions.html">normal</a></span>(<span class="dv">0</span>, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb14-10" data-line-number="10">sd &lt;-<span class="st"> </span><span class="kw"><a href="../reference/distributions.html">student</a></span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">truncation =</span> <span class="kw"><a href="../reference/extract-replace-combine.html">c</a></span>(<span class="dv">0</span>, <span class="ot">Inf</span>))</a>
<a class="sourceLine" id="cb14-11" data-line-number="11"></a>
<a class="sourceLine" id="cb14-12" data-line-number="12"><span class="co"># operations</span></a>
<a class="sourceLine" id="cb14-13" data-line-number="13">mean &lt;-<span class="st"> </span>int <span class="op">+</span><span class="st"> </span>coef <span class="op">*</span><span class="st"> </span>x</a>
<a class="sourceLine" id="cb14-14" data-line-number="14"></a>
<a class="sourceLine" id="cb14-15" data-line-number="15"><span class="co"># likelihood</span></a>
<a class="sourceLine" id="cb14-16" data-line-number="16"><span class="kw"><a href="../reference/distribution.html">distribution</a></span>(y) &lt;-<span class="st"> </span><span class="kw"><a href="../reference/distributions.html">normal</a></span>(mean, sd)</a>
<a class="sourceLine" id="cb14-17" data-line-number="17"></a>
<a class="sourceLine" id="cb14-18" data-line-number="18"><span class="co"># defining the model</span></a>
<a class="sourceLine" id="cb14-19" data-line-number="19">m &lt;-<span class="st"> </span><span class="kw"><a href="../reference/model.html">model</a></span>(int, coef, sd)</a>
<a class="sourceLine" id="cb14-20" data-line-number="20"></a>
<a class="sourceLine" id="cb14-21" data-line-number="21"><span class="co"># plotting</span></a>
<a class="sourceLine" id="cb14-22" data-line-number="22"><span class="kw">plot</span>(m)</a>
<a class="sourceLine" id="cb14-23" data-line-number="23"></a>
<a class="sourceLine" id="cb14-24" data-line-number="24"><span class="co"># sampling</span></a>
<a class="sourceLine" id="cb14-25" data-line-number="25">draws &lt;-<span class="st"> </span><span class="kw"><a href="../reference/inference.html">mcmc</a></span>(m, <span class="dt">n_samples =</span> <span class="dv">1000</span>)</a></code></pre></div>
<hr>
<div id="data" class="section level3">
<h3 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h3>
<p>The first section of the script takes the iris data (which is automatically loaded) and converts the two columns we care about into greta arrays:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as_data.html">as_data</a></span>(iris<span class="op">$</span>Petal.Length)</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">y &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as_data.html">as_data</a></span>(iris<span class="op">$</span>Sepal.Length)</a></code></pre></div>
<p>The greta function <code><a href="../reference/as_data.html">as_data()</a></code> converts other R objects into greta arrays. In this case it’s converting numeric vectors (the two columns of the iris dataframe) into greta arrays. <code><a href="../reference/as_data.html">as_data()</a></code> can also convert matrices and R arrays with numeric, integer or logical (<code>TRUE</code> or <code>FALSE</code>) values into greta arrays. It can also convert dataframes to greta arrays, so long as all elements are either numeric, integer or logical.</p>
<p>E.g. we can convert the first 5 rows and 4 columns of the iris dataframe, and print the result:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw"><a href="../reference/as_data.html">as_data</a></span>(iris[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>])</a></code></pre></div>
<pre><code>greta array (data)

     [,1] [,2] [,3] [,4]
[1,]  5.1  3.5  1.4  0.2
[2,]  4.9  3.0  1.4  0.2
[3,]  4.7  3.2  1.3  0.2
[4,]  4.6  3.1  1.5  0.2
[5,]  5.0  3.6  1.4  0.2</code></pre>
<p>Whenever <code><a href="../reference/as_data.html">as_data()</a></code> converts logical values to greta arrays, it converts them to 1s (for <code>TRUE</code>) and 0s (for <code>FALSE</code>). E.g. if we first convert the last column of <code>iris</code> from a factor into a logical vector, we can see this:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">(is_setosa &lt;-<span class="st"> </span>iris<span class="op">$</span>Species[<span class="kw"><a href="../reference/extract-replace-combine.html">c</a></span>(<span class="dv">1</span>, <span class="dv">41</span>, <span class="dv">81</span>, <span class="dv">121</span>)] <span class="op">==</span><span class="st"> "setosa"</span>)</a></code></pre></div>
<pre><code>[1]  TRUE  TRUE FALSE FALSE</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw"><a href="../reference/as_data.html">as_data</a></span>(is_setosa)</a></code></pre></div>
<pre><code>greta array (data)

     [,1]
[1,]    1
[2,]    1
[3,]    0
[4,]    0</code></pre>
<p>You can also see from this example that greta arrays always consider a vector as either a column vector (the default) or a row vector, and greta arrays always have at least two dimensions:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw">dim</span>(<span class="kw"><a href="../reference/as_data.html">as_data</a></span>(is_setosa))</a></code></pre></div>
<pre><code>[1] 4 1</code></pre>
<div id="explicit-vs-automatic-conversion" class="section level4">
<h4 class="hasAnchor">
<a href="#explicit-vs-automatic-conversion" class="anchor"></a>explicit vs. automatic conversion</h4>
<p>For many models, we don’t <em>have</em> to explicitly convert data to greta arrays, the R objects will be converted automatically when we do an <a href="#Operations">operation</a> on them. That’s handy for when we want to use constants in our model because it saves us manually converting numbers each time. However, it’s good practice to explicitly convert your data to a greta array using <code><a href="../reference/as_data.html">as_data()</a></code>. This has two advantages: it lets greta work out the names of your data greta arrays (e.g. <code>x</code> and <code>y</code> in our example) which it can use when <a href="#Plotting">plotting</a> the model; and <code><a href="../reference/as_data.html">as_data()</a></code> will check your data for missing (<code>NA</code>) or non-finite (<code>Inf</code> or <code>-Inf</code>) values, which will break the model.</p>
</div>
<div id="data-structures" class="section level4">
<h4 class="hasAnchor">
<a href="#data-structures" class="anchor"></a>data structures</h4>
<p>greta also provides some convenience functions to generate fixed numeric values. <code><a href="../reference/structures.html">ones()</a></code> and <code><a href="../reference/structures.html">zeros()</a></code> create greta arrays filled with either 1 or zero, and with the specified dimensions:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="kw"><a href="../reference/structures.html">ones</a></span>(<span class="dv">1</span>, <span class="dv">3</span>)</a></code></pre></div>
<pre><code>greta array (data)

     [,1] [,2] [,3]
[1,]    1    1    1</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="kw"><a href="../reference/structures.html">zeros</a></span>(<span class="dv">2</span>, <span class="dv">2</span>)</a></code></pre></div>
<pre><code>greta array (data)

     [,1] [,2]
[1,]    0    0
[2,]    0    0</code></pre>
<p>The <code><a href="../reference/structures.html">greta_array()</a></code> function generalises this to let you create greta arrays with any values, in the same way as R’s <code>array()</code> function:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="kw"><a href="../reference/structures.html">greta_array</a></span>(pi, <span class="dt">dim =</span> <span class="kw"><a href="../reference/extract-replace-combine.html">c</a></span>(<span class="dv">2</span>, <span class="dv">2</span>))</a></code></pre></div>
<pre><code>greta array (data)

         [,1]     [,2]
[1,] 3.141593 3.141593
[2,] 3.141593 3.141593</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="kw"><a href="../reference/structures.html">greta_array</a></span>(<span class="dv">0</span><span class="op">:</span><span class="dv">1</span>, <span class="dt">dim =</span> <span class="kw"><a href="../reference/extract-replace-combine.html">c</a></span>(<span class="dv">3</span>, <span class="dv">3</span>))</a></code></pre></div>
<pre><code>greta array (data)

     [,1] [,2] [,3]
[1,]    0    1    0
[2,]    1    0    1
[3,]    0    1    0</code></pre>
<p><code><a href="../reference/structures.html">greta_array()</a></code> is just a thin wrapper around <code>array()</code>, provided for convenience. A command like <code>greta_array(&lt;some arguments&gt;)</code> has exactly the same effect as: <code>as_data(array&lt;some arguments&gt;)</code>.</p>
<hr>
</div>
</div>
<div id="variables-and-priors" class="section level3">
<h3 class="hasAnchor">
<a href="#variables-and-priors" class="anchor"></a>Variables and priors</h3>
<p>The second section of the script creates three greta arrays to represent the parameters in our model:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1">int &lt;-<span class="st"> </span><span class="kw"><a href="../reference/distributions.html">normal</a></span>(<span class="dv">0</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb32-2" data-line-number="2">coef &lt;-<span class="st"> </span><span class="kw"><a href="../reference/distributions.html">normal</a></span>(<span class="dv">0</span>, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb32-3" data-line-number="3">sd &lt;-<span class="st"> </span><span class="kw"><a href="../reference/distributions.html">student</a></span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">truncation =</span> <span class="kw"><a href="../reference/extract-replace-combine.html">c</a></span>(<span class="dv">0</span>, <span class="ot">Inf</span>))</a></code></pre></div>
<p>Each of these is a variable greta array, and each is assumed <em>a priori</em> (before fitting to data) to follow a different probability distribution. In other words, these are prior distributions over variables, which we need to specify to make this a full Bayesian analysis. Before going through how to specify variables with proability distributions, it will be clearer to first demonstrate the alternative; variables without probabiltiy distributions.</p>
<div id="variables-without-probability-distributions" class="section level4">
<h4 class="hasAnchor">
<a href="#variables-without-probability-distributions" class="anchor"></a>variables without probability distributions</h4>
<p>If we were carrying out a frequentist analysis of this model, we could create variable greta arrays (values we want to learn) without probability distributions using the <code><a href="../reference/variable.html">variable()</a></code> function. E.g. in a frequentist version of the model we could create <code>int</code> with:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1">(int &lt;-<span class="st"> </span><span class="kw"><a href="../reference/variable.html">variable</a></span>())</a></code></pre></div>
<pre><code>greta array (variable)

     [,1]
[1,]  ?  </code></pre>
<p><code><a href="../reference/variable.html">variable()</a></code> has three arguments. The first two arguments determine the constraints on this parameter; we left them at their default setting of <code>lower = -Inf, upper = Inf</code> meaning the variables can take any value on the real number line. The third argument gives the dimensions of the greta array to return, in this case we left it at its default value of 1x1 (a scalar).</p>
<p>We can create a variable constrained between two values by specifying <code>lower</code> and <code>upper</code>. So we could have created the positive variable <code>sd</code> (the standard deviation of the likelihood) with:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1">(sd &lt;-<span class="st"> </span><span class="kw"><a href="../reference/variable.html">variable</a></span>(<span class="dt">lower =</span> <span class="dv">0</span>))</a></code></pre></div>
<pre><code>greta array (variable)

     [,1]
[1,]  ?  </code></pre>
<p>If we had instead wanted a 2x3 array of positive variables we could have created it like this:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1"><span class="kw"><a href="../reference/variable.html">variable</a></span>(<span class="dt">lower =</span> <span class="dv">0</span>, <span class="dt">dim =</span> <span class="kw"><a href="../reference/extract-replace-combine.html">c</a></span>(<span class="dv">2</span>, <span class="dv">3</span>))</a></code></pre></div>
<pre><code>greta array (variable)

     [,1] [,2] [,3]
[1,]  ?    ?    ?  
[2,]  ?    ?    ?  </code></pre>
</div>
<div id="variables-with-probability-distributions" class="section level4">
<h4 class="hasAnchor">
<a href="#variables-with-probability-distributions" class="anchor"></a>variables with probability distributions</h4>
<p>In our example script, when we created the variables <code>int</code>, <code>coef</code> and <code>sd</code>, we simultaneously stated the prior distributions for them using some of greta’s probability distribution functions. You can see a list of the currently available distributions in the <a href="https://greta-dev.github.io/greta/distributions.html"><code><a href="../reference/distributions.html">?greta::distributions</a></code></a> helpfile. Each of these distribution functions takes as arguments the distribution’s parameters (either as numbers or other greta arrays), as well as the dimensions of the resulting greta array. As before, we left the dimensions arguments at their default value to create scalar greta arrays.</p>
<p>Both <code>int</code> and <code>coef</code> were given zero-mean normal distributions, which are a common choice of prior for unconstrained variables in Bayesian analyses. For the strictly positive parameter <code>sd</code>, we chose a slightly unconvential option, a positive-truncated (non-standard) student’s t distribution, which we create using greta’s built-in support for truncated distributions.</p>
</div>
<div id="variables-with-truncated-distributions" class="section level4">
<h4 class="hasAnchor">
<a href="#variables-with-truncated-distributions" class="anchor"></a>variables with truncated distributions</h4>
<p>Some of greta’s probability distributions (those that are continous and univariate) can be specified as truncated distributions. By modifying the <code>truncation</code> argument, we can state that the resulting distribution should be truncated between the two truncation bounds. So to create a standard normal distribution truncated between -1 and 1 we can do:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1">(z &lt;-<span class="st"> </span><span class="kw"><a href="../reference/distributions.html">normal</a></span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">truncation =</span> <span class="kw"><a href="../reference/extract-replace-combine.html">c</a></span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)))</a></code></pre></div>
<pre><code>greta array (variable following a normal distribution)

     [,1]
[1,]  ?  </code></pre>
<p>greta will account for this truncation when calculating the density of this distribution; rescaling it to be a valid probability distribution. We can only truncate to within the support of the distribution; e.g. greta will throw an error if we try to truncate a lognormal distribution (which must be positive) to have a lower bound of -1.</p>
<hr>
</div>
</div>
<div id="operations" class="section level3">
<h3 class="hasAnchor">
<a href="#operations" class="anchor"></a>Operations</h3>
<p>The third section of the script uses mathematical operators to combine some of our parameters and data, to calculate the predicted sepal lengths, for a given parameter set:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1">mean &lt;-<span class="st"> </span>int <span class="op">+</span><span class="st"> </span>coef <span class="op">*</span><span class="st"> </span>x</a></code></pre></div>
<p>Because <code>int</code> and <code>coef</code> are both scalars, the resulting greta array <code>mean</code> has the same dimensions as <code>x</code>; a column vector with 150 elements:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1"><span class="kw">dim</span>(mean)</a></code></pre></div>
<pre><code>[1] 150   1</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1"><span class="kw">head</span>(mean)</a></code></pre></div>
<pre><code>greta array (operation)

     [,1]
[1,]  ?  
[2,]  ?  
[3,]  ?  
[4,]  ?  
[5,]  ?  
[6,]  ?  </code></pre>
<p>greta arrays can be manipulated using R’s standard arithmetic, logical and relational operators; including <code>+</code>, <code>*</code> and many others. The <a href="https://greta-dev.github.io/greta/operators.html"><code><a href="../reference/operators.html">?greta::operators</a></code></a> helpfile lists the operators that are implemeneted for greta arrays. You can also use a lot of common R functions for numeric data, such as <code>sum()</code>, <code>log()</code> and others. the available functions are listed in the <a href="https://greta-dev.github.io/greta/functions.html"><code><a href="../reference/functions.html">?greta::functions</a></code></a> helpfile. All of these mathematical manipulations of greta arrays produce ‘operation’ greta arrays.</p>
<div id="extract-and-replace" class="section level4">
<h4 class="hasAnchor">
<a href="#extract-and-replace" class="anchor"></a>Extract and replace</h4>
<p>We can use R’s extract and replace syntax (using <code>[</code>) on greta arrays, just like with R’s vectors, matrices and arrays. E.g. to extract elements from <code>mean</code> we can do:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1">mean[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]</a></code></pre></div>
<pre><code>greta array (operation)

     [,1]
[1,]  ?  
[2,]  ?  
[3,]  ?  </code></pre>
<p>We can assign values from one greta array to another too. For example, if we wanted to create a matrix that has random normal variables in the first column, but zeros everywhere else, we could do:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" data-line-number="1">z &lt;-<span class="st"> </span><span class="kw"><a href="../reference/structures.html">zeros</a></span>(<span class="dv">4</span>, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb48-2" data-line-number="2">z[, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw"><a href="../reference/distributions.html">normal</a></span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">dim =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb48-3" data-line-number="3">z</a></code></pre></div>
<pre><code>greta array (operation)

     [,1] [,2] [,3]
[1,]  ?   0    0   
[2,]  ?   0    0   
[3,]  ?   0    0   
[4,]  ?   0    0   </code></pre>
<p>R’s subset operator <code>[</code> has an argument <code>drop</code>, which determines whether to reduce the number of dimensions of a array or matrix when the object has zero elements in that dimension. By default, <code>drop = TRUE</code> for R objects, so matrices are automatically converted into vectors (which have dimension <code>NULL</code>) if you take out a single column:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" data-line-number="1">z &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span>, <span class="dt">nrow =</span> <span class="dv">2</span>, <span class="dt">ncol =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb50-2" data-line-number="2"><span class="kw">dim</span>(z[, <span class="dv">1</span>])</a></code></pre></div>
<pre><code>NULL</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" data-line-number="1"><span class="kw">dim</span>(z[, <span class="dv">1</span>, <span class="dt">drop =</span> <span class="ot">FALSE</span>])</a></code></pre></div>
<pre><code>[1] 2 1</code></pre>
<p>greta arrays must always have two dimensions, so greta always acts as though <code>drop = FALSE</code>:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" data-line-number="1">z_greta &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as_data.html">as_data</a></span>(z)</a>
<a class="sourceLine" id="cb54-2" data-line-number="2"><span class="kw">dim</span>(z_greta[, <span class="dv">1</span>])</a></code></pre></div>
<pre><code>[1] 2 1</code></pre>
</div>
<div id="functions" class="section level4">
<h4 class="hasAnchor">
<a href="#functions" class="anchor"></a>Functions</h4>
<p>We can write our own functions for greta arrays, using the existing operators and functions. For example, we could define the <a href="https://en.wikipedia.org/wiki/Inverse_hyperbolic_function#Inverse_hyperbolic_tangent">inverse hyperbolic tangent function</a> for greta arrays like this:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" data-line-number="1">atanh &lt;-<span class="st"> </span><span class="cf">function</span> (z)</a>
<a class="sourceLine" id="cb56-2" data-line-number="2">  (<span class="kw">log</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>z) <span class="op">-</span><span class="st"> </span><span class="kw">log</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>z)) <span class="op">/</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb56-3" data-line-number="3"></a>
<a class="sourceLine" id="cb56-4" data-line-number="4"><span class="kw">atanh</span>(z_greta)</a></code></pre></div>
<pre><code>greta array (operation)

     [,1] [,2]
[1,]  ?    ?  
[2,]  ?    ?  </code></pre>
<hr>
</div>
</div>
<div id="likelihood" class="section level3">
<h3 class="hasAnchor">
<a href="#likelihood" class="anchor"></a>Likelihood</h3>
<p>So far, we have created greta arrays representing the variables in our model (with prior distributions) and created other greta arrays from them and some fixed, <em>independent</em> data. To perform statistical inference on this model, we also need to link it to some observed <em>dependent</em> data. By comparing the sepal lengths predicted under different parameter values with the observed sepal lengths, we can estimate the most plausible values of those parameters. We do that by defining a likelihood for the observed sepal length data <code>y</code>.</p>
<p>By defining a likelihood over observed data, we are stating that these observed data are actually a random sample from some probability distribution, and we’re trying to work out the parameters of that distribution. In greta we do that with the <code><a href="../reference/distribution.html">distribution()</a></code> assignment function:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" data-line-number="1"><span class="kw"><a href="../reference/distribution.html">distribution</a></span>(y) &lt;-<span class="st"> </span><span class="kw"><a href="../reference/distributions.html">normal</a></span>(mean, sd)</a></code></pre></div>
<p>With the syntax <code>distribution(&lt;lhs&gt;) &lt;- &lt;rhs&gt;</code>, we are stating that the data greta array on the left <code>&lt;lhs&gt;</code> has the same distribution as the greta array on the right <code>&lt;rhs&gt;</code>. In this case, we’re temporarily creating a random variable with a normal distribution (with parameters determined by the greta arrays <code>mean</code> and <code>sd</code>), but then stating that values of that distribution have been observed (<code>y</code>). In this case both <code>&lt;lhs&gt;</code> (<code>y</code>) and <code>&lt;rhs&gt;</code> are column vectors with the same dimensions, so each element in <code>y</code> has a normal distribution with the corresponding parameters.</p>
<hr>
</div>
<div id="defining-the-model" class="section level3">
<h3 class="hasAnchor">
<a href="#defining-the-model" class="anchor"></a>Defining the model</h3>
<p>Now all of the greta arrays making up the model have been created, we need to combine them and set up the model so that we can sample from it, using <code><a href="../reference/model.html">model()</a></code>:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" data-line-number="1">m &lt;-<span class="st"> </span><span class="kw"><a href="../reference/model.html">model</a></span>(int, coef, sd)</a></code></pre></div>
<p><code><a href="../reference/model.html">model()</a></code> returns a ‘greta model’ object, which combines all of the greta arrays that make up the model. We can pass greta arrays as arguments to <code><a href="../reference/model.html">model()</a></code> to flag them as the parameters we’re interested in. When sampling from the model with <code><a href="../reference/inference.html">mcmc()</a></code> those will be the greta arrays for which samples will be returned. Alternatively, we can run <code><a href="../reference/model.html">model()</a></code> without passing any greta arrays, in which case all of the greta arrays (except for data greta arrays) in the working environment will be set as the targets for sampling instead.</p>
<hr>
</div>
<div id="plotting" class="section level3">
<h3 class="hasAnchor">
<a href="#plotting" class="anchor"></a>Plotting</h3>
<p>greta provides a plot function for greta models to help you visualise and check the model before sampling from it.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" data-line-number="1"><span class="kw">plot</span>(m)</a></code></pre></div>
<div id="htmlwidget-13bb4d1454d1110e0087" style="width:700px;height:432.632880098888px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-13bb4d1454d1110e0087">{"x":{"diagram":"digraph {\n\ngraph [layout = \"dot\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\",\n       rankdir = \"LR\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"int\n\", fontcolor = \"#8960B3\", fontsize = \"12\", penwidth = \"2\", shape = \"circle\", color = \"#E0D2EE\", width = \"0.6\", height = \"0.48\", fillcolor = \"#F4F0F9\"] \n  \"2\" [label = \"normal\", fontcolor = \"#8960B3\", fontsize = \"12\", penwidth = \"2\", shape = \"diamond\", color = \"#B797D7\", width = \"1\", height = \"0.8\", fillcolor = \"#E0D2EE\"] \n  \"3\" [label = \"0\", fontcolor = \"#8960B3\", fontsize = \"12\", penwidth = \"2\", shape = \"square\", color = \"#E0D2EE\", width = \"0.5\", height = \"0.4\", fillcolor = \"#FFFFFF\"] \n  \"4\" [label = \"1\", fontcolor = \"#8960B3\", fontsize = \"12\", penwidth = \"2\", shape = \"square\", color = \"#E0D2EE\", width = \"0.5\", height = \"0.4\", fillcolor = \"#FFFFFF\"] \n  \"5\" [label = \"mean\n\", fontcolor = \"#8960B3\", fontsize = \"12\", penwidth = \"2\", shape = \"circle\", color = \"lightgray\", width = \"0.2\", height = \"0.16\", fillcolor = \"#D3D3D3\"] \n  \"6\" [label = \"normal\", fontcolor = \"#8960B3\", fontsize = \"12\", penwidth = \"2\", shape = \"diamond\", color = \"#B797D7\", width = \"1\", height = \"0.8\", fillcolor = \"#E0D2EE\"] \n  \"7\" [label = \"sd\n\", fontcolor = \"#8960B3\", fontsize = \"12\", penwidth = \"2\", shape = \"circle\", color = \"#E0D2EE\", width = \"0.6\", height = \"0.48\", fillcolor = \"#F4F0F9\"] \n  \"8\" [label = \"student\", fontcolor = \"#8960B3\", fontsize = \"12\", penwidth = \"2\", shape = \"diamond\", color = \"#B797D7\", width = \"1\", height = \"0.8\", fillcolor = \"#E0D2EE\"] \n  \"9\" [label = \"3\", fontcolor = \"#8960B3\", fontsize = \"12\", penwidth = \"2\", shape = \"square\", color = \"#E0D2EE\", width = \"0.5\", height = \"0.4\", fillcolor = \"#FFFFFF\"] \n  \"10\" [label = \"0\", fontcolor = \"#8960B3\", fontsize = \"12\", penwidth = \"2\", shape = \"square\", color = \"#E0D2EE\", width = \"0.5\", height = \"0.4\", fillcolor = \"#FFFFFF\"] \n  \"11\" [label = \"1\", fontcolor = \"#8960B3\", fontsize = \"12\", penwidth = \"2\", shape = \"square\", color = \"#E0D2EE\", width = \"0.5\", height = \"0.4\", fillcolor = \"#FFFFFF\"] \n  \"12\" [label = \"y\n\", fontcolor = \"#8960B3\", fontsize = \"12\", penwidth = \"2\", shape = \"square\", color = \"#E0D2EE\", width = \"0.5\", height = \"0.4\", fillcolor = \"#FFFFFF\"] \n  \"13\" [label = \"\", fontcolor = \"#8960B3\", fontsize = \"12\", penwidth = \"2\", shape = \"circle\", color = \"lightgray\", width = \"0.2\", height = \"0.16\", fillcolor = \"#D3D3D3\"] \n  \"14\" [label = \"coef\n\", fontcolor = \"#8960B3\", fontsize = \"12\", penwidth = \"2\", shape = \"circle\", color = \"#E0D2EE\", width = \"0.6\", height = \"0.48\", fillcolor = \"#F4F0F9\"] \n  \"15\" [label = \"normal\", fontcolor = \"#8960B3\", fontsize = \"12\", penwidth = \"2\", shape = \"diamond\", color = \"#B797D7\", width = \"1\", height = \"0.8\", fillcolor = \"#E0D2EE\"] \n  \"16\" [label = \"0\", fontcolor = \"#8960B3\", fontsize = \"12\", penwidth = \"2\", shape = \"square\", color = \"#E0D2EE\", width = \"0.5\", height = \"0.4\", fillcolor = \"#FFFFFF\"] \n  \"17\" [label = \"3\", fontcolor = \"#8960B3\", fontsize = \"12\", penwidth = \"2\", shape = \"square\", color = \"#E0D2EE\", width = \"0.5\", height = \"0.4\", fillcolor = \"#FFFFFF\"] \n  \"18\" [label = \"x\n\", fontcolor = \"#8960B3\", fontsize = \"12\", penwidth = \"2\", shape = \"square\", color = \"#E0D2EE\", width = \"0.5\", height = \"0.4\", fillcolor = \"#FFFFFF\"] \n\"1\"->\"5\" [color = \"Gainsboro\", fontname = \"Helvetica\", fontcolor = \"gray\", fontsize = \"11\", penwidth = \"3\", label = \"add\", style = \"solid\"] \n\"2\"->\"1\" [color = \"Gainsboro\", fontname = \"Helvetica\", fontcolor = \"gray\", fontsize = \"11\", penwidth = \"3\", penwidth = \"3\", style = \"dashed\"] \n\"3\"->\"2\" [color = \"Gainsboro\", fontname = \"Helvetica\", fontcolor = \"gray\", fontsize = \"11\", penwidth = \"3\", label = \"mean\", style = \"solid\"] \n\"4\"->\"2\" [color = \"Gainsboro\", fontname = \"Helvetica\", fontcolor = \"gray\", fontsize = \"11\", penwidth = \"3\", label = \"sd\", style = \"solid\"] \n\"5\"->\"6\" [color = \"Gainsboro\", fontname = \"Helvetica\", fontcolor = \"gray\", fontsize = \"11\", penwidth = \"3\", label = \"mean\", style = \"solid\"] \n\"6\"->\"12\" [color = \"Gainsboro\", fontname = \"Helvetica\", fontcolor = \"gray\", fontsize = \"11\", penwidth = \"3\", penwidth = \"3\", style = \"dashed\"] \n\"7\"->\"6\" [color = \"Gainsboro\", fontname = \"Helvetica\", fontcolor = \"gray\", fontsize = \"11\", penwidth = \"3\", label = \"sd\", style = \"solid\"] \n\"8\"->\"7\" [color = \"Gainsboro\", fontname = \"Helvetica\", fontcolor = \"gray\", fontsize = \"11\", penwidth = \"3\", penwidth = \"3\", style = \"dashed\"] \n\"9\"->\"8\" [color = \"Gainsboro\", fontname = \"Helvetica\", fontcolor = \"gray\", fontsize = \"11\", penwidth = \"3\", label = \"df\", style = \"solid\"] \n\"10\"->\"8\" [color = \"Gainsboro\", fontname = \"Helvetica\", fontcolor = \"gray\", fontsize = \"11\", penwidth = \"3\", label = \"mu\", style = \"solid\"] \n\"11\"->\"8\" [color = \"Gainsboro\", fontname = \"Helvetica\", fontcolor = \"gray\", fontsize = \"11\", penwidth = \"3\", label = \"sigma\", style = \"solid\"] \n\"13\"->\"5\" [color = \"Gainsboro\", fontname = \"Helvetica\", fontcolor = \"gray\", fontsize = \"11\", penwidth = \"3\", label = \"add\", style = \"solid\"] \n\"14\"->\"13\" [color = \"Gainsboro\", fontname = \"Helvetica\", fontcolor = \"gray\", fontsize = \"11\", penwidth = \"3\", label = \"multiply\", style = \"solid\"] \n\"15\"->\"14\" [color = \"Gainsboro\", fontname = \"Helvetica\", fontcolor = \"gray\", fontsize = \"11\", penwidth = \"3\", penwidth = \"3\", style = \"dashed\"] \n\"16\"->\"15\" [color = \"Gainsboro\", fontname = \"Helvetica\", fontcolor = \"gray\", fontsize = \"11\", penwidth = \"3\", label = \"mean\", style = \"solid\"] \n\"17\"->\"15\" [color = \"Gainsboro\", fontname = \"Helvetica\", fontcolor = \"gray\", fontsize = \"11\", penwidth = \"3\", label = \"sd\", style = \"solid\"] \n\"18\"->\"13\" [color = \"Gainsboro\", fontname = \"Helvetica\", fontcolor = \"gray\", fontsize = \"11\", penwidth = \"3\", label = \"multiply\", style = \"solid\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>The greta arrays in your workspace that are used in the model are all represented as nodes (shapes) with names. These are either data (squares; <code>x</code> and <code>y</code>), variables (large circles; <code>int</code>, <code>coef</code>, <code>sd</code>) or the results of operations (small circles; <code>mean</code>). The operations used to create the operation greta arrays are printed on the arrows from the arrays they were made from. There are also nodes for greta arrays that were <em>implicitly defined</em> in our model. The data nodes (squares) with numbers are the parameters used to define the prior distributions, and there’s also an intermediate operation node (small circle), which was the result of multiplying <code>coef</code> and <code>x</code> (before adding <code>int</code> to create <code>mean</code>).</p>
<p>Here’s a legend for the plot (it’s in the <a href="https://greta-dev.github.io/greta/model.html"><code><a href="../reference/model.html">?greta::model</a></code></a> helpfile too):</p>
<p>
<img src="figures/plotlegend.png" width="750"></p>
<p>The fourth type of node (diamonds) represents probability distributions. These have greta arrays as parameters (linked via solid lines), and have other greta arrays as <em>values</em>(linked via dashed lines). Distributions calculate the probability density of the <em>values</em>, given the parameters and their distribution type.</p>
<p>For example, a plot of just the prior distribution over <code>coef</code> (defined as <code>coef &lt;- normal(0, 3)</code>) shows the parameters as data leading into the normal distribution, and a dashed arrow leading out to the distribution’s value, the variable <code>coef</code>:</p>
<div id="htmlwidget-a0019dfb932b498a770c" style="width:700px;height:432.632880098888px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-a0019dfb932b498a770c">{"x":{"diagram":"digraph {\n\ngraph [layout = \"dot\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\",\n       rankdir = \"LR\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"coef\n\", fontcolor = \"#8960B3\", fontsize = \"12\", penwidth = \"2\", shape = \"circle\", color = \"#E0D2EE\", width = \"0.6\", height = \"0.48\", fillcolor = \"#F4F0F9\"] \n  \"2\" [label = \"normal\", fontcolor = \"#8960B3\", fontsize = \"12\", penwidth = \"2\", shape = \"diamond\", color = \"#B797D7\", width = \"1\", height = \"0.8\", fillcolor = \"#E0D2EE\"] \n  \"3\" [label = \"0\", fontcolor = \"#8960B3\", fontsize = \"12\", penwidth = \"2\", shape = \"square\", color = \"#E0D2EE\", width = \"0.5\", height = \"0.4\", fillcolor = \"#FFFFFF\"] \n  \"4\" [label = \"3\", fontcolor = \"#8960B3\", fontsize = \"12\", penwidth = \"2\", shape = \"square\", color = \"#E0D2EE\", width = \"0.5\", height = \"0.4\", fillcolor = \"#FFFFFF\"] \n\"2\"->\"1\" [color = \"Gainsboro\", fontname = \"Helvetica\", fontcolor = \"gray\", fontsize = \"11\", penwidth = \"3\", penwidth = \"3\", style = \"dashed\"] \n\"3\"->\"2\" [color = \"Gainsboro\", fontname = \"Helvetica\", fontcolor = \"gray\", fontsize = \"11\", penwidth = \"3\", label = \"mean\", style = \"solid\"] \n\"4\"->\"2\" [color = \"Gainsboro\", fontname = \"Helvetica\", fontcolor = \"gray\", fontsize = \"11\", penwidth = \"3\", label = \"sd\", style = \"solid\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>It’s the same for the model likelihood, but this time the distribution’s parameters are a variable (<code>sd</code>) and the result of an operation (<code>mean</code>), and the distribution’s value is given by data (the observed sepal lengths <code>y</code>):</p>
<div id="htmlwidget-30109e4c315914d93acc" style="width:700px;height:432.632880098888px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-30109e4c315914d93acc">{"x":{"diagram":"digraph {\n\ngraph [layout = \"dot\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\",\n       rankdir = \"LR\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"sd\n\", fontcolor = \"#8960B3\", fontsize = \"12\", penwidth = \"2\", shape = \"circle\", color = \"#E0D2EE\", width = \"0.6\", height = \"0.48\", fillcolor = \"#F4F0F9\"] \n  \"2\" [label = \"normal\", fontcolor = \"#8960B3\", fontsize = \"12\", penwidth = \"2\", shape = \"diamond\", color = \"#B797D7\", width = \"1\", height = \"0.8\", fillcolor = \"#E0D2EE\"] \n  \"3\" [label = \"mean\n\", fontcolor = \"#8960B3\", fontsize = \"12\", penwidth = \"2\", shape = \"square\", color = \"#E0D2EE\", width = \"0.5\", height = \"0.4\", fillcolor = \"#FFFFFF\"] \n  \"4\" [label = \"y\n\", fontcolor = \"#8960B3\", fontsize = \"12\", penwidth = \"2\", shape = \"square\", color = \"#E0D2EE\", width = \"0.5\", height = \"0.4\", fillcolor = \"#FFFFFF\"] \n\"1\"->\"2\" [color = \"Gainsboro\", fontname = \"Helvetica\", fontcolor = \"gray\", fontsize = \"11\", penwidth = \"3\", label = \"sd\", style = \"solid\"] \n\"2\"->\"4\" [color = \"Gainsboro\", fontname = \"Helvetica\", fontcolor = \"gray\", fontsize = \"11\", penwidth = \"3\", penwidth = \"3\", style = \"dashed\"] \n\"3\"->\"2\" [color = \"Gainsboro\", fontname = \"Helvetica\", fontcolor = \"gray\", fontsize = \"11\", penwidth = \"3\", label = \"mean\", style = \"solid\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><hr>
</div>
<div id="sampling" class="section level3">
<h3 class="hasAnchor">
<a href="#sampling" class="anchor"></a>Sampling</h3>
<p>When defining the model, greta combines all of the distributions together to define the <em>joint density</em> of the model, a measure of how ‘good’ (or how probable if we’re being Bayesian) are a particular candidate set of values for the variables in the model.</p>
<p>Now we have a greta model that will give us the joint density for a candidate set of values, so we can use that to carry out inference on the model. We do that using an Markov chain Monte Carlo (MCMC) algorithm to sample values of the parameters we’re interested in, using the <code><a href="../reference/inference.html">mcmc()</a></code> function:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" data-line-number="1">draws &lt;-<span class="st"> </span><span class="kw"><a href="../reference/inference.html">mcmc</a></span>(m, <span class="dt">n_samples =</span> <span class="dv">1000</span>)</a></code></pre></div>
<p>Here we’re using 1000 steps of the static Hamiltonian Monte Carlo (HMC) algorithm on each of 4 separate chains, giving us 4000 samples. HMC uses the gradients of the joint density to efficiently explore the set of parameters. By default, greta also spends 1000 iterations on each chain ‘warming up’ (tuning the sampler parameters) and ‘burning in’ (moving to the area of highest probability) the sampler.</p>
<p><code>draws</code> is an <code>mcmc.list</code> object, from the coda R package. So we can use functions from coda, or one of the many other MCMC software packages that use this format, to plot and summarise the MCMC samples.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" data-line-number="1"><span class="kw">summary</span>(draws)</a></code></pre></div>
<pre><code>
Iterations = 1:1000
Thinning interval = 1 
Number of chains = 4 
Sample size per chain = 1000 

1. Empirical mean and standard deviation for each variable,
   plus standard error of the mean:

       Mean      SD  Naive SE Time-series SE
int  4.2803 0.07807 0.0012343      0.0014083
sd   0.4103 0.02395 0.0003787      0.0004092
coef 0.4146 0.01884 0.0002979      0.0003364

2. Quantiles for each variable:

       2.5%    25%    50%    75%  97.5%
int  4.1245 4.2286 4.2814 4.3325 4.4310
sd   0.3668 0.3933 0.4090 0.4259 0.4616
coef 0.3774 0.4021 0.4143 0.4272 0.4516</code></pre>
<p>The bayesplot package makes some nice plots of the MCMC chain and the parameter estimates</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" data-line-number="1"><span class="kw">library</span> (bayesplot)</a>
<a class="sourceLine" id="cb64-2" data-line-number="2"><span class="kw"><a href="http://www.rdocumentation.org/packages/bayesplot/topics/MCMC-traces">mcmc_trace</a></span>(draws)</a>
<a class="sourceLine" id="cb64-3" data-line-number="3"><span class="kw"><a href="http://www.rdocumentation.org/packages/bayesplot/topics/MCMC-intervals">mcmc_intervals</a></span>(draws)</a></code></pre></div>
<p><img src="get_started_files/figure-html/mcmcvis-1.png" width="400px"><img src="get_started_files/figure-html/mcmcvis-2.png" width="400px"></p>
<p>If your model is taking a long time whilst in the sampling phase and you want to take a look at the samples. You can stop the sampler (e.g. using the stop button in RStudio) and then retrieve the samples drawn so far, by using <code><a href="../reference/inference.html">stashed_samples()</a></code>. Note that this won’t return anything if you stop the model during the warmup phase (since those aren’t valid posterior samples) or if the sampler completed successfully.</p>
<div id="tweaking-the-sampler" class="section level4">
<h4 class="hasAnchor">
<a href="#tweaking-the-sampler" class="anchor"></a>Tweaking the sampler</h4>
<p>greta’s default sampler is (static) Hamiltonian Monte Carlo. The sampler will automatically tune itself during the warmup phase, to make it as efficient as possible. If the chain looks like it’s moving too slowly, or if you are getting a lot of messages about proposals being rejected, the first thing to try is increasing the length of the warmup period from its default of 1000 interations (via the <code>warmup</code> argument). If you’re still getting a lot of rejected samples, it’s often a good idea to manually set the initial values for the sampler (via the <code>initial_values</code> argument). This is often the case when you have lots of data; the more information there is, the more extreme the log probability, and the higher the risk of numerical problems.</p>
<p>A downside of HMC is that it can’t be used to sample discrete variables (e.g. integers), so we can’t specify a model with a discrete distribution (e.g. Poisson or Binomial), unless it’s in the likelihood. If we try to build such a model, greta will give us an error when we run <code><a href="../reference/model.html">model()</a></code>. Future versions of greta will implement a wider range of MCMC samplers, including some for discrete variables.</p>
<hr>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <ul class="nav nav-pills nav-stacked">
<li><a href="#installation">Installation</a></li>
      <li><a href="#how-greta-works">How greta works</a></li>
      <li><a href="#building-a-model">Building a model</a></li>
      </ul>
</div>
      </div>

</div>


      <footer></footer>
</div>

  
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script><script>
  docsearch({
    
    
    apiKey: 'fa1406e0044eae29be11408a723039e7',
    indexName: 'greta',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
